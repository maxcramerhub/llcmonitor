{% extends 'base.html' %}

{% block title %}Success{% endblock %}

{% block content %}

<!-- dynamic success page with interval -->
<div class="container mt-5 text-center">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">
            <div class="alert alert-info position-relative py-5 px-5 shadow-lg" style="z-index: 1; border-radius: 20px; font-size: 1.5rem;">
                {% for message in messages %}
                    {% if message.tags == 'success' %}
                        <div class="mb-4">
                            <i id="random" style="font-size: 4rem;"></i>
                        </div>
                        <h1 class="display-4 mb-4">{{ message }}</h1>
                        {% if request.GET.checkout_status %}
                            <h2 class="display-6 mb-4">Would you like to leave a review?</h2>
                            <div class="d-flex flex-wrap justify-content-center gap-4">
                                <a href="{% url 'monitor:leave_review' %}" class="btn btn-success py-4 px-5 fs-1 shadow-lg" style="min-width: 150px;">Yes</a>
                                <button onclick="launchConfettiAndRedirect()" class="btn btn-secondary py-4 px-5 fs-1 shadow-lg" style="min-width: 150px;">No</button>
                            </div>
                        {% endif %}
                    {% else %}
                        <h2 class="display-5">{{ message }}</h2>
                    {% endif %}
                {% endfor %}
                
                <!-- Continue button to skip timeout -->
                <div class="mt-4">
                    <button onclick="skipTimeout()" class="btn btn-primary py-4 px-5 fs-1 shadow-lg" style="min-width: 200px;">
                        <i class="fas fa-arrow-right me-2"></i>Continue
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>



<script>
    // for fun :)
    const icons = [
        "fa-solid fa-hand-sparkles",
        "fa-solid fa-trophy",
        "fa-solid fa-thumbs-up",
        "fa-solid fa-hat-wizard",
        "fa-regular fa-face-smile"
    ];
    const randomIndex = Math.floor(Math.random() * icons.length);
    const selectedIcon = icons[randomIndex];
    
    const item = document.getElementById('random');
    item.innerHTML = `<i class="${selectedIcon}"></i>`;


    let timeLeft = 6;
    let countdown;
    
    countdown = setInterval(function() {
        timeLeft--;
        
        if (timeLeft <= 0) {
            clearInterval(countdown);
            window.location.href = "{% url 'monitor:index' %}";
        }
    }, 1000);
    
    function skipTimeout() {
        clearInterval(countdown);
        window.location.href = "{% url 'monitor:index' %}";
    }
</script>

<script>
    function launchConfettiAndRedirect() {
        confetti({
            particleCount: 300,
            spread: 800,
            origin: { y: 0.6 }
        });

        setTimeout(function() {
            window.location.href = "{% url 'monitor:index' %}";
        }, 1000); // Wait 1 second before redirecting
    }
</script>



{% if confetti %}
    <script>
        // Launch the confetti effect if confetti is True
        launchConfettiAndRedirect();
    </script>
{% endif %}


{% endblock %}